"use strict";

"SELECT\nclients.id,\nclients.nom,\nclients.prenoms,\nclients.numero_ifu,\nclients.numero_telephone,\nclients.email,\nclients.date_ajout,\nCOALESCE(achat.total_dettes_mois, 0) AS total_dettes_mois,\nCOALESCE(paiement_mois.total_paiements_mois, 0) AS total_paiements_mois,\nCOALESCE(dettes_global.total_dettes_global, 0) AS total_dettes_global,\nCOALESCE(paiement_global.total_paiements_global, 0) AS total_paiements_global,\nCASE\n    WHEN (COALESCE(paiement_global.total_paiements_global, 0) - COALESCE(dettes_global.total_dettes_global, 0)) > 0 THEN (COALESCE(paiement_global.total_paiements_global, 0) - COALESCE(dettes_global.total_dettes_global, 0))\n    ELSE 0\nEND AS avance,\nCASE\n    WHEN (COALESCE(dettes_global.total_dettes_global, 0) - COALESCE(paiement_global.total_paiements_global, 0)) > 0 THEN (COALESCE(dettes_global.total_dettes_global, 0) - COALESCE(paiement_global.total_paiements_global, 0))\n    ELSE 0\nEND AS creance,\nCOALESCE(achat_cimbenin.total_dettes_mois, 0) AS total_dettes_mois_CIMBENIN,\nCOALESCE(paiement_mois_cimbenin.total_paiements_mois, 0) AS total_paiements_mois_CIMBENIN,\nCOALESCE(dettes_global_cimbenin.total_dettes_global, 0) AS total_dettes_global_CIMBENIN,\nCOALESCE(paiement_global_cimbenin.total_paiements_global, 0) AS total_paiements_global_CIMBENIN,\nCASE\n    WHEN (COALESCE(paiement_global_cimbenin.total_paiements_global, 0) - COALESCE(dettes_global_cimbenin.total_dettes_global, 0)) > 0 THEN (COALESCE(paiement_global_cimbenin.total_paiements_global, 0) - COALESCE(dettes_global_cimbenin.total_dettes_global, 0))\n    ELSE 0\nEND AS avance_CIMBENIN,\nCASE\n    WHEN (COALESCE(dettes_global_cimbenin.total_dettes_global, 0) - COALESCE(paiement_global_cimbenin.total_paiements_global, 0)) > 0 THEN (COALESCE(dettes_global_cimbenin.total_dettes_global, 0) - COALESCE(paiement_global_cimbenin.total_paiements_global, 0))\n    ELSE 0\nEND AS creance_CIMBENIN,\nCOALESCE(achat_nocibe.total_dettes_mois, 0) AS total_dettes_mois_NOCIBE,\nCOALESCE(paiement_mois_nocibe.total_paiements_mois, 0) AS total_paiements_mois_NOCIBE,\nCOALESCE(dettes_global_nocibe.total_dettes_global, 0) AS total_dettes_global_NOCIBE,\nCOALESCE(paiement_global_nocibe.total_paiements_global, 0) AS total_paiements_global_NOCIBE,\nCASE\n    WHEN (COALESCE(paiement_global_nocibe.total_paiements_global, 0) - COALESCE(dettes_global_nocibe.total_dettes_global, 0)) > 0 THEN (COALESCE(paiement_global_nocibe.total_paiements_global, 0) - COALESCE(dettes_global_nocibe.total_dettes_global, 0))\n    ELSE 0\nEND AS avance_NOCIBE,\nCASE\n    WHEN (COALESCE(dettes_global_nocibe.total_dettes_global, 0) - COALESCE(paiement_global_nocibe.total_paiements_global, 0)) > 0 THEN (COALESCE(dettes_global_nocibe.total_dettes_global, 0) - COALESCE(paiement_global_nocibe.total_paiements_global, 0))\n    ELSE 0\nEND AS creance_NOCIBE\nFROM clients\nLEFT JOIN\n-- total dettes mois --\n(SELECT id_client, SUM(montant) AS total_dettes_mois\n FROM achat_client\n-- WHERE date_achat BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\n WHERE date_achat BETWEEN '2023-10-01' AND '2023-10-20'\n GROUP BY id_client) AS achat\nON clients.id = achat.id_client\nLEFT JOIN\n-- total paiements mois --\n(SELECT id_client, SUM(montant) AS total_paiements_mois\n FROM paiement_client\n WHERE est_valide = 1\n -- AND date_paiement BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\nAND date_paiement BETWEEN '2023-10-01' AND '2023-10-20' \n GROUP BY id_client) AS paiement_mois\nON clients.id = paiement_mois.id_client\nLEFT JOIN\n-- total dettes global --\n(SELECT id_client, SUM(montant) AS total_dettes_global\n FROM achat_client\n WHERE achat_client.date_achat <= '2023-10-20'\n GROUP BY id_client) AS dettes_global\nON clients.id = dettes_global.id_client\nLEFT JOIN\n-- total paiements global --\n(SELECT id_client, SUM(montant) AS total_paiements_global\n FROM paiement_client\n WHERE est_valide = 1\n  AND paiement_client.date_paiement <= '2023-10-20'\n GROUP BY id_client) AS paiement_global\nON clients.id = paiement_global.id_client\nLEFT JOIN\n-- total dettes mois CIM BENIN --\n(SELECT id_client, SUM(montant) AS total_dettes_mois\n FROM achat_client\n-- WHERE date_achat BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\n   WHERE date_achat BETWEEN '2023-10-01' AND '2023-10-20' \n   AND categorie = 'CIM BENIN'\n GROUP BY id_client) AS achat_cimbenin\nON clients.id = achat_cimbenin.id_client\nLEFT JOIN\n-- total paiements mois CIM BENIN --\n(SELECT id_client, SUM(montant) AS total_paiements_mois\n FROM paiement_client\n WHERE est_valide = 1\n--    AND date_paiement BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\n  AND date_paiement BETWEEN '2023-10-01' AND '2023-10-20' \n   AND categorie = 'CIM BENIN'\n GROUP BY id_client) AS paiement_mois_cimbenin\nON clients.id = paiement_mois_cimbenin.id_client\nLEFT JOIN\n-- total dettes global CIM BENIN --\n(SELECT id_client, SUM(montant) AS total_dettes_global\n FROM achat_client\n WHERE categorie = 'CIM BENIN'\n   AND achat_client.date_achat <= '2023-10-20'\n GROUP BY id_client) AS dettes_global_cimbenin\nON clients.id = dettes_global_cimbenin.id_client\nLEFT JOIN\n-- total paiements global CIM BENIN --\n(SELECT id_client, SUM(montant) AS total_paiements_global\n FROM paiement_client\n WHERE est_valide = 1\n   AND categorie = 'CIM BENIN'\n  AND paiement_client.date_paiement <= '2023-10-20'\n GROUP BY id_client) AS paiement_global_cimbenin\nON clients.id = paiement_global_cimbenin.id_client\nLEFT JOIN\n-- total dettes mois NOCIBE --\n(SELECT id_client, SUM(montant) AS total_dettes_mois\n FROM achat_client\n--    WHERE date_achat BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\n   WHERE date_achat BETWEEN '2023-10-01' AND '2023-10-20' \n   AND categorie = 'NOCIBE'\n GROUP BY id_client) AS achat_nocibe\nON clients.id = achat_nocibe.id_client\nLEFT JOIN\n-- total paiements mois NOCIBE --\n(SELECT id_client, SUM(montant) AS total_paiements_mois\n FROM paiement_client\n WHERE est_valide = 1\n--   AND date_paiement BETWEEN DATE_FORMAT(NOW(), '%Y-%m-01') AND NOW()\n  AND date_paiement BETWEEN '2023-10-01' AND '2023-10-20' \n   AND categorie = 'NOCIBE'\n GROUP BY id_client) AS paiement_mois_nocibe\nON clients.id = paiement_mois_nocibe.id_client\nLEFT JOIN\n-- total dettes global NOCIBE --\n(SELECT id_client, SUM(montant) AS total_dettes_global\n FROM achat_client\n WHERE categorie = 'NOCIBE'\n   AND achat_client.date_achat <= '2023-10-20'\n GROUP BY id_client) AS dettes_global_nocibe\nON clients.id = dettes_global_nocibe.id_client\nLEFT JOIN\n-- total paiements global NOCIBE --\n(SELECT id_client, SUM(montant) AS total_paiements_global\n FROM paiement_client\n WHERE est_valide = 1\n   AND categorie = 'NOCIBE'\n   AND paiement_client.date_paiement <= '2023-10-20'\n GROUP BY id_client) AS paiement_global_nocibe\nON clients.id = paiement_global_nocibe.id_client;";